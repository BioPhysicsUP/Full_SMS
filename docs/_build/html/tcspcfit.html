
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>tcspcfit &#8212; UP Biophysics SMS Analysis 0.1 documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="module-tcspcfit">
<span id="tcspcfit"></span><h1>tcspcfit<a class="headerlink" href="#module-tcspcfit" title="Permalink to this headline">¶</a></h1>
<p>Module for fitting TCSPC data.</p>
<p>The function distfluofit is based on MATLAB code by Jörg Enderlein:
<a class="reference external" href="https://www.uni-goettingen.de/en/513325.html">https://www.uni-goettingen.de/en/513325.html</a></p>
<p>Bertus van Heerden
University of Pretoria</p>
<dl class="class">
<dt id="tcspcfit.FluoFit">
<em class="property">class </em><code class="sig-prename descclassname">tcspcfit.</code><code class="sig-name descname">FluoFit</code><span class="sig-paren">(</span><em class="sig-param">irf</em>, <em class="sig-param">measured</em>, <em class="sig-param">t</em>, <em class="sig-param">channelwidth</em>, <em class="sig-param">tau=None</em>, <em class="sig-param">amp=None</em>, <em class="sig-param">shift=None</em>, <em class="sig-param">bg=None</em>, <em class="sig-param">irfbg=None</em>, <em class="sig-param">startpoint=None</em>, <em class="sig-param">endpoint=None</em>, <em class="sig-param">ploton=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tcspcfit.html#FluoFit"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tcspcfit.FluoFit" title="Permalink to this definition">¶</a></dt>
<dd><p>Base class for fit of a multi-exponential decay curve.</p>
<p>This class is only used for subclassing.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>irf</strong> (<em>ndarray</em>) – Instrumental Response Function</p></li>
<li><p><strong>measured</strong> (<em>ndarray</em>) – The measured decay data</p></li>
<li><p><strong>channelwidth</strong> (<em>float</em>) – Time width of one TCSPC channel (in nanoseconds)</p></li>
<li><p><strong>tau</strong> (<em>array_like</em><em>, </em><em>optional</em>) – Initial guess times (in ns). This is either in the format
[tau1, tau2, …] or [[tau1, min1, max1, fix1], [tau2, …], …].
When the “fix” value is False, the min and max values are ignored.</p></li>
<li><p><strong>amp</strong> (<em>array_like</em><em>, </em><em>optional</em>) – Initial guess amplitude. Format [amp1, amp2, …] or [[amp1, fix1],
[amp2, fix2], …]</p></li>
<li><p><strong>shift</strong> (<em>array_like</em><em>, </em><em>optional</em>) – Initial guess IRF shift. Either a float, or [shift, min, max, fix].</p></li>
<li><p><strong>bg</strong> (<em>float</em>) – Background value for decay. Will be estimated if not given.</p></li>
<li><p><strong>irfbg</strong> (<em>float</em>) – Background value for IRF. Will be estimated if not given.</p></li>
<li><p><strong>startpoint</strong> (<em>int</em>) – Start of fitting range - will default to channel of decay max or
IRF max, whichever is least.</p></li>
<li><p><strong>endpoint</strong> (<em>int</em>) – End of fitting range - will default to the channel of the
fluorescence decay that is either around 10 times higher than the
background level or equivalent to 0.1% of the counts in the peak
channel, whichever is greater.</p></li>
<li><p><strong>init</strong> (<em>bool  # TODO: add this functionality</em>) – Whether to use an initial guess routine or not.</p></li>
<li><p><strong>ploton</strong> (<em>bool</em>) – Whether to automatically plot the irf_data</p></li>
</ul>
</dd>
</dl>
<dl class="method">
<dt id="tcspcfit.FluoFit.calculate_bg">
<code class="sig-name descname">calculate_bg</code><span class="sig-paren">(</span><em class="sig-param">bg</em>, <em class="sig-param">irf</em>, <em class="sig-param">irfbg</em>, <em class="sig-param">measured</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tcspcfit.html#FluoFit.calculate_bg"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tcspcfit.FluoFit.calculate_bg" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate decay and IRF background values</p>
<p>If not given, the  background value is estimated from the first part
of the curve, before the rise.</p>
<dl class="simple">
<dt>bg<span class="classifier">float</span></dt><dd><p>Decay background value</p>
</dd>
<dt>irf<span class="classifier">ndarray</span></dt><dd><p>Instrument response function</p>
</dd>
<dt>irfbg<span class="classifier">float</span></dt><dd><p>IRF background value</p>
</dd>
<dt>measured<span class="classifier">ndarray</span></dt><dd><p>Measured decay data</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="tcspcfit.FluoFit.calculate_boundaries">
<code class="sig-name descname">calculate_boundaries</code><span class="sig-paren">(</span><em class="sig-param">endpoint</em>, <em class="sig-param">measured</em>, <em class="sig-param">startpoint</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tcspcfit.html#FluoFit.calculate_boundaries"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tcspcfit.FluoFit.calculate_boundaries" title="Permalink to this definition">¶</a></dt>
<dd><p>Set the start and endpoints</p>
<p>Sets the values to the given ones or automatically find good ones.
The start value is chosen as the maximum point of the IRF, and the end
value is chosen as either the point where the decay is 1 % of
maximum or 10 times the background value, whichever is highest.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>endpoint</strong> (<em>int</em>) – End of fitting range</p></li>
<li><p><strong>measured</strong> (<em>ndarray</em>) – The measured decay data</p></li>
<li><p><strong>startpoint</strong> (<em>int</em>) – Start of fitting range</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="tcspcfit.FluoFit.makeconvd">
<code class="sig-name descname">makeconvd</code><span class="sig-paren">(</span><em class="sig-param">shift</em>, <em class="sig-param">model</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tcspcfit.html#FluoFit.makeconvd"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tcspcfit.FluoFit.makeconvd" title="Permalink to this definition">¶</a></dt>
<dd><p>Makes a convolved decay using IRF and exponential model</p>
<dl class="simple">
<dt>shift<span class="classifier">float</span></dt><dd><p>IRF colour shift</p>
</dd>
<dt>model<span class="classifier">ndarray</span></dt><dd><p>Exponential model function</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="tcspcfit.FluoFit.results">
<code class="sig-name descname">results</code><span class="sig-paren">(</span><em class="sig-param">tau</em>, <em class="sig-param">dtau</em>, <em class="sig-param">shift</em>, <em class="sig-param">amp=1</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tcspcfit.html#FluoFit.results"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tcspcfit.FluoFit.results" title="Permalink to this definition">¶</a></dt>
<dd><p>Handle results after fitting</p>
<p>After fitting, the results are processed. Chi-squared is calculated
and optional plotting is done.</p>
<dl class="simple">
<dt>tau<span class="classifier">ndarray or float</span></dt><dd><p>Fitted lifetime(s)</p>
</dd>
<dt>dtau<span class="classifier">ndarray or float</span></dt><dd><p>Error in fitted lifetimes</p>
</dd>
<dt>shift<span class="classifier">float</span></dt><dd><p>Fitted colourshift value</p>
</dd>
<dt>amp<span class="classifier">ndarray or float</span></dt><dd><p>Fitted amplitude(s)</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="tcspcfit.FluoFit.setup_params">
<code class="sig-name descname">setup_params</code><span class="sig-paren">(</span><em class="sig-param">amp</em>, <em class="sig-param">shift</em>, <em class="sig-param">tau</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tcspcfit.html#FluoFit.setup_params"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tcspcfit.FluoFit.setup_params" title="Permalink to this definition">¶</a></dt>
<dd><p>Setup fitting parameters</p>
<p>This method handles the input of initial parameters for fitting. The
input system is flexible, allowing optional input of min and max
values as well as choosing to fix a value.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>amp</strong> (<em>list</em><em> or </em><em>float</em>) – Amplitude(s)</p></li>
<li><p><strong>shift</strong> (<em>list</em><em> or </em><em>float</em>) – IRF colour shift</p></li>
<li><p><strong>tau</strong> (<em>list</em><em> or </em><em>float</em>) – Lifetime(s)</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="tcspcfit.OneExp">
<em class="property">class </em><code class="sig-prename descclassname">tcspcfit.</code><code class="sig-name descname">OneExp</code><span class="sig-paren">(</span><em class="sig-param">irf</em>, <em class="sig-param">measured</em>, <em class="sig-param">t</em>, <em class="sig-param">channelwidth</em>, <em class="sig-param">tau=None</em>, <em class="sig-param">amp=None</em>, <em class="sig-param">shift=None</em>, <em class="sig-param">bg=None</em>, <em class="sig-param">irfbg=None</em>, <em class="sig-param">startpoint=None</em>, <em class="sig-param">endpoint=None</em>, <em class="sig-param">ploton=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tcspcfit.html#OneExp"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tcspcfit.OneExp" title="Permalink to this definition">¶</a></dt>
<dd><p>“Single exponential fit. Takes exact same arguments as Fluofit</p>
<dl class="method">
<dt id="tcspcfit.OneExp.fitfunc">
<code class="sig-name descname">fitfunc</code><span class="sig-paren">(</span><em class="sig-param">t</em>, <em class="sig-param">tau1</em>, <em class="sig-param">a</em>, <em class="sig-param">shift</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tcspcfit.html#OneExp.fitfunc"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tcspcfit.OneExp.fitfunc" title="Permalink to this definition">¶</a></dt>
<dd><p>Function passed to curve_fit, to be fitted to data</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="tcspcfit.ThreeExp">
<em class="property">class </em><code class="sig-prename descclassname">tcspcfit.</code><code class="sig-name descname">ThreeExp</code><span class="sig-paren">(</span><em class="sig-param">irf</em>, <em class="sig-param">measured</em>, <em class="sig-param">t</em>, <em class="sig-param">channelwidth</em>, <em class="sig-param">tau=None</em>, <em class="sig-param">amp=None</em>, <em class="sig-param">shift=None</em>, <em class="sig-param">bg=None</em>, <em class="sig-param">irfbg=None</em>, <em class="sig-param">startpoint=None</em>, <em class="sig-param">endpoint=None</em>, <em class="sig-param">ploton=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tcspcfit.html#ThreeExp"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tcspcfit.ThreeExp" title="Permalink to this definition">¶</a></dt>
<dd><p>“Triple exponential fit. Takes exact same arguments as Fluofit</p>
<dl class="method">
<dt id="tcspcfit.ThreeExp.fitfunc">
<code class="sig-name descname">fitfunc</code><span class="sig-paren">(</span><em class="sig-param">t</em>, <em class="sig-param">tau1</em>, <em class="sig-param">tau2</em>, <em class="sig-param">tau3</em>, <em class="sig-param">a1</em>, <em class="sig-param">a2</em>, <em class="sig-param">a3</em>, <em class="sig-param">shift</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tcspcfit.html#ThreeExp.fitfunc"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tcspcfit.ThreeExp.fitfunc" title="Permalink to this definition">¶</a></dt>
<dd><p>Function passed to curve_fit, to be fitted to data</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="tcspcfit.TwoExp">
<em class="property">class </em><code class="sig-prename descclassname">tcspcfit.</code><code class="sig-name descname">TwoExp</code><span class="sig-paren">(</span><em class="sig-param">irf</em>, <em class="sig-param">measured</em>, <em class="sig-param">t</em>, <em class="sig-param">channelwidth</em>, <em class="sig-param">tau=None</em>, <em class="sig-param">amp=None</em>, <em class="sig-param">shift=None</em>, <em class="sig-param">bg=None</em>, <em class="sig-param">irfbg=None</em>, <em class="sig-param">startpoint=None</em>, <em class="sig-param">endpoint=None</em>, <em class="sig-param">ploton=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tcspcfit.html#TwoExp"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tcspcfit.TwoExp" title="Permalink to this definition">¶</a></dt>
<dd><p>“Double exponential fit. Takes exact same arguments as Fluofit</p>
<dl class="method">
<dt id="tcspcfit.TwoExp.fitfunc">
<code class="sig-name descname">fitfunc</code><span class="sig-paren">(</span><em class="sig-param">t</em>, <em class="sig-param">tau1</em>, <em class="sig-param">tau2</em>, <em class="sig-param">a1</em>, <em class="sig-param">a2</em>, <em class="sig-param">shift</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tcspcfit.html#TwoExp.fitfunc"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tcspcfit.TwoExp.fitfunc" title="Permalink to this definition">¶</a></dt>
<dd><p>Function passed to curve_fit, to be fitted to data</p>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="tcspcfit.colorshift">
<code class="sig-prename descclassname">tcspcfit.</code><code class="sig-name descname">colorshift</code><span class="sig-paren">(</span><em class="sig-param">irf</em>, <em class="sig-param">shift</em>, <em class="sig-param">irflength=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tcspcfit.html#colorshift"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tcspcfit.colorshift" title="Permalink to this definition">¶</a></dt>
<dd><p>Shift irf left or right ‘periodically’.</p>
<p>A shift past the start or end results in those values of irf
‘wrapping around’.</p>
<p>Arguments:
irf – row vector or 1D
shift – float
irflength – float
t – 1D vector</p>
<p>Output:
irs – shifted irf, as row vector</p>
</dd></dl>

<dl class="function">
<dt id="tcspcfit.convol">
<code class="sig-prename descclassname">tcspcfit.</code><code class="sig-name descname">convol</code><span class="sig-paren">(</span><em class="sig-param">irf</em>, <em class="sig-param">decay</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tcspcfit.html#convol"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tcspcfit.convol" title="Permalink to this definition">¶</a></dt>
<dd><p>Performs a convolution of irf with decay.</p>
<p>Periodicity (period = size(decay)) is assumed.</p>
<p>Arguments:
irf – row vector or 1D
decay – 1D or array with irf_data in rows</p>
<p>Output
y – convolution of irf with each row of decay.</p>
</dd></dl>

<dl class="function">
<dt id="tcspcfit.distfluofit">
<code class="sig-prename descclassname">tcspcfit.</code><code class="sig-name descname">distfluofit</code><span class="sig-paren">(</span><em class="sig-param">irf, measured, period, channelwidth, cshift_bounds=[-3, 3], choose=False, ntau=50</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tcspcfit.html#distfluofit"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tcspcfit.distfluofit" title="Permalink to this definition">¶</a></dt>
<dd><p>Quickly fit a multiexponential decay to use as ‘initial guess’</p>
<blockquote>
<div><p>The function aims to identify the number of lifetimes in the
measured irf_data, as well as the values of the lifetimes. The result
can be used as an initial guess for fluofit.</p>
</div></blockquote>
<p>Arguments:
irf – Instrumental Response Function measured – Fluorescence decay irf_data
period – Time between laser exciation pulses (in nanoseconds)
channelwidth – Time width of one TCSPC channel (in nanoseconds)
tau – Initial guess times
taubounds – limits for the lifetimes guess times - defaults to 0&lt;tau&lt;100</p>
<blockquote>
<div><p>format: [[tau1_min, tau1_max], [tau2_min, tau2_max], …]</p>
</div></blockquote>
<p>init – Whether to use a initial guess routine or not</p>
<p>Output:
peak_tau    – Decay times of the different decay components
TODO: Add all other outputs
c – Color Shift (time shift of the IRF w.r.t. the fluorescence curve)
offset – Offset
amplitudes – Amplitudes of the different decay components
dc – Color shift error
doffset – Offset error
dtau – Decay times error
irs – IRF, shifted by the value of the colorshift
separated_decays – Fitted fluorecence component curves
t – time axis
chisquared – chi squared value</p>
</dd></dl>

<dl class="function">
<dt id="tcspcfit.makerow">
<code class="sig-prename descclassname">tcspcfit.</code><code class="sig-name descname">makerow</code><span class="sig-paren">(</span><em class="sig-param">vector</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/tcspcfit.html#makerow"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tcspcfit.makerow" title="Permalink to this definition">¶</a></dt>
<dd><p>Reshape 1D vector into a 2D row</p>
</dd></dl>

</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">UP Biophysics SMS Analysis</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, Bertus van Heerden, Joshua Botha.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.4.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/tcspcfit.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>